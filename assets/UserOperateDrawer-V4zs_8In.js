var H=Object.defineProperty;var _=(r,e,t)=>e in r?H(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var x=(r,e,t)=>_(r,typeof e!="symbol"?e+"":e,t);import{r as p,e7 as y,e as M,aw as E,w as N,f as U,Q as D,B as G,k as d,J as B}from"./index-a8HA_olk.js";import{i as $,s as q,a as z,b as V,u as J}from"./subscribeFocus-C5bCTwVN.js";import{a as Q,i as X,d as Y}from"./debounce-CQG8kKAD.js";import{a as Z,u as R}from"./index-B6yV8mlE.js";import{R as b,u as k,e as I}from"./index-Db-okRQM.js";import{a as L}from"./system-manage-CYwmPSZW.js";import{F as P}from"./index-k0luiw77.js";import{D as W}from"./index-ChCFCP0M.js";import{F as K}from"./index-3aLPTGmV.js";import{I as w}from"./index-Bg8cWT0S.js";import{S as ee}from"./index-DA2nkpKa.js";import"./_baseGetTag-BfcSlXwI.js";import"./tslib.es6-CwN1OpI9.js";import"./index-CabrCW5N.js";import"./index-B9cAjCKS.js";import"./form-DHI9Ht2D.js";import"./row-g_7vVTN1.js";import"./responsiveObserver-DSveI0h0.js";import"./use-loading-Dd0MtzaK.js";import"./index-BQoTp0qd.js";import"./index-BYHEeVqq.js";import"./EllipsisOutlined-I2IEM31j.js";import"./Overflow-nffGhOx7.js";import"./DownOutlined-HthGj266.js";import"./index-YUCgnSbO.js";import"./LeftOutlined-Cm8qkUv3.js";import"./Sider-CZCndbiG.js";import"./useBreakpoint-B8bDBiWO.js";import"./index-D24tXTwy.js";import"./index-CBYbD1Wh.js";import"./SearchOutlined-Da6u6qg4.js";import"./index-BvxnZR04.js";function T(r,e){var t=p.useRef({deps:e,obj:void 0,initialized:!1}).current;return(t.initialized===!1||!y(t.deps,e))&&(t.deps=e,t.obj=r(),t.initialized=!0),t.obj}var re=Q,te=X,ne="Expected a function";function se(r,e,t){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(ne);return te(t)&&(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i),re(r,e,{leading:n,maxWait:e,trailing:i})}var ie=se;const oe=M(ie),A=new Map,ue=(r,e,t)=>{const n=A.get(r);n!=null&&n.timer&&clearTimeout(n.timer);let i;e>-1&&(i=setTimeout(()=>{A.delete(r)},e)),A.set(r,{...t,timer:i})},ae=r=>A.get(r),F=new Map,le=r=>F.get(r),ce=(r,e)=>{F.set(r,e),e.then(t=>(F.delete(r),t)).catch(()=>{F.delete(r)})},j={},me=(r,e)=>{j[r]&&j[r].forEach(t=>t(e))},S=(r,e)=>(j[r]||(j[r]=[]),j[r].push(e),function(){const n=j[r].indexOf(e);j[r].splice(n,1)}),fe=(r,{cacheKey:e,cacheTime:t=5*60*1e3,staleTime:n=0,setCache:i,getCache:s})=>{const o=p.useRef(),c=p.useRef(),f=(u,a)=>{i?i(a):ue(u,t,a),me(u,a.data)},l=(u,a=[])=>s?s(a):ae(u);return T(()=>{if(!e)return;const u=l(e);u&&Object.hasOwn(u,"data")&&(r.state.data=u.data,r.state.params=u.params,(n===-1||new Date().getTime()-u.time<=n)&&(r.state.loading=!1)),o.current=S(e,a=>{r.setState({data:a})})},[]),E(()=>{var u;(u=o.current)==null||u.call(o)}),e?{onBefore:u=>{const a=l(e,u);return!a||!Object.hasOwn(a,"data")?{}:n===-1||new Date().getTime()-a.time<=n?{loading:!1,data:a==null?void 0:a.data,error:void 0,returnNow:!0}:{data:a==null?void 0:a.data,error:void 0}},onRequest:(u,a)=>{let m=le(e);return m&&m!==c.current?{servicePromise:m}:(m=u(...a),c.current=m,ce(e,m),{servicePromise:m})},onSuccess:(u,a)=>{var m;e&&((m=o.current)==null||m.call(o),f(e,{data:u,params:a,time:new Date().getTime()}),o.current=S(e,v=>{r.setState({data:v})}))},onMutate:u=>{var a;e&&((a=o.current)==null||a.call(o),f(e,{data:u,params:r.state.params,time:new Date().getTime()}),o.current=S(e,m=>{r.setState({data:m})}))}}:{}},de=(r,{debounceWait:e,debounceLeading:t,debounceTrailing:n,debounceMaxWait:i})=>{const s=p.useRef(),o=p.useMemo(()=>{const c={};return t!==void 0&&(c.leading=t),n!==void 0&&(c.trailing=n),i!==void 0&&(c.maxWait=i),c},[t,n,i]);return p.useEffect(()=>{if(e){const c=r.runAsync.bind(r);return s.current=Y(f=>{f()},e,o),r.runAsync=(...f)=>new Promise((l,u)=>{var a;(a=s.current)==null||a.call(s,()=>{c(...f).then(l).catch(u)})}),()=>{var f;(f=s.current)==null||f.cancel(),r.runAsync=c}}return()=>{}},[e,o]),e?{onCancel:()=>{var c;(c=s.current)==null||c.cancel()}}:{}},pe=(r,{loadingDelay:e,ready:t})=>{const n=p.useRef();if(!e)return{};const i=()=>{n.current&&clearTimeout(n.current)};return{onBefore:()=>(i(),t!==!1&&(n.current=setTimeout(()=>{r.setState({loading:!0})},e)),{loading:!1}),onFinally:()=>{i()},onCancel:()=>{i()}}},ge=(r,{pollingInterval:e,pollingWhenHidden:t=!0,pollingErrorRetryCount:n=-1})=>{const i=p.useRef(),s=p.useRef(),o=p.useRef(0),c=()=>{var f;i.current&&clearTimeout(i.current),(f=s.current)==null||f.call(s)};return N(()=>{e||c()},[e]),e?{onBefore:()=>(c(),null),onError:()=>{o.current+=1},onSuccess:()=>{o.current=0},onFinally:()=>{n===-1||n!==-1&&o.current<=n?i.current=setTimeout(()=>{!t&&!$()?s.current=q(()=>{r.refresh()}):r.refresh()},e):o.current=0},onCancel:()=>{c()}}:{}};function he(r,e){let t=!1;return(...n)=>{t||(t=!0,r(...n),setTimeout(()=>{t=!1},e))}}const Pe=(r,{refreshOnWindowFocus:e,focusTimespan:t=5e3})=>{const n=p.useRef(),i=()=>{var s;(s=n.current)==null||s.call(n)};return p.useEffect(()=>{if(e){const s=he(r.refresh.bind(r),t);n.current=z(()=>{s()})}return()=>{i()}},[e,t]),E(()=>{i()}),{}},je=(r,{retryInterval:e,retryCount:t})=>{const n=p.useRef(),i=p.useRef(0),s=p.useRef(!1);return t?{onBefore:()=>(s.current||(i.current=0),s.current=!1,n.current&&clearTimeout(n.current),null),onSuccess:()=>{i.current=0},onError:()=>{if(i.current+=1,t===-1||i.current<=t){const o=e??Math.min(1e3*2**i.current,3e4);n.current=setTimeout(()=>{s.current=!0,r.refresh()},o)}else i.current=0},onCancel:()=>{i.current=0,n.current&&clearTimeout(n.current)}}:{}},Re=(r,{throttleWait:e,throttleLeading:t,throttleTrailing:n})=>{const i=p.useRef(),s={};return t!==void 0&&(s.leading=t),n!==void 0&&(s.trailing=n),p.useEffect(()=>{if(e){const o=r.runAsync.bind(r);return i.current=oe(c=>{c()},e,s),r.runAsync=(...c)=>new Promise((f,l)=>{var u;(u=i.current)==null||u.call(i,()=>{o(...c).then(f).catch(l)})}),()=>{var c;r.runAsync=o,(c=i.current)==null||c.cancel()}}return()=>{}},[e,t,n]),e?{onCancel:()=>{var o;(o=i.current)==null||o.cancel()}}:{}};class ve{constructor(e,t,n,i={}){x(this,"pluginImpls");x(this,"count",0);x(this,"state",{loading:!1,params:void 0,response:null,data:void 0,error:null});this.serviceRef=e,this.options=t,this.subscribe=n,this.initState=i,this.state={...this.state,loading:!t.manual,...i}}setState(e={}){this.state={...this.state,...e},this.subscribe()}runPluginHandler(e,...t){const n=this.pluginImpls.map(i=>{var s;return(s=i[e])==null?void 0:s.call(i,...t)}).filter(Boolean);return Object.assign({},...n)}async runAsync(...e){var o,c,f,l,u,a,m,v,C,O;this.count+=1;const t=this.count,{stopNow:n=!1,returnNow:i=!1,...s}=this.runPluginHandler("onBefore",e);if(n)return new Promise(()=>{});if(this.setState({loading:!0,params:e,...s}),i)return Promise.resolve(s.data);(c=(o=this.options).onBefore)==null||c.call(o,e);try{let{servicePromise:h}=this.runPluginHandler("onRequest",this.serviceRef.current,e);h||(h=this.serviceRef.current(...e));const g=await h;return t!==this.count?new Promise(()=>{}):(this.setState({data:g.data,error:null,response:g.response,loading:!1}),(l=(f=this.options).onSuccess)==null||l.call(f,g.data,e),this.runPluginHandler("onSuccess",g,e),(a=(u=this.options).onFinally)==null||a.call(u,e,g.data,null),t===this.count&&this.runPluginHandler("onFinally",e,g,null),g)}catch(h){const g=h;if(t!==this.count)return new Promise(()=>{});throw this.setState({error:g,data:null,response:h.response,loading:!1}),(v=(m=this.options).onError)==null||v.call(m,g,e),this.runPluginHandler("onError",h,e),(O=(C=this.options).onFinally)==null||O.call(C,e,void 0,g),t===this.count&&this.runPluginHandler("onFinally",e,void 0,h),h}}run(...e){this.runAsync(...e).catch(t=>{this.options.onError||console.error(t)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const t=V(e)?e(this.state.data):e;this.runPluginHandler("onMutate",t),this.setState({data:t})}}function xe(r,e={},t=[]){const{manual:n=!1,ready:i=!0,...s}=e,o={manual:n,ready:i,...s},c=U(r),f=Z(),l=T(()=>{const u=t.map(a=>{var m;return(m=a==null?void 0:a.onInit)==null?void 0:m.call(a,o)}).filter(Boolean);return new ve(c,o,f,Object.assign({},...u))},[]);return l.options=o,l.pluginImpls=t.map(u=>u(l,o)),D(()=>{if(!n&&i){const u=l.state.params||e.defaultParams||[];l.run(...u)}}),E(()=>{l.cancel()}),{loading:l.state.loading,data:l.state.data,error:l.state.error,params:l.state.params||[],cancel:R(l.cancel.bind(l)),refresh:R(l.refresh.bind(l)),refreshAsync:R(l.refreshAsync.bind(l)),run:R(l.run.bind(l)),runAsync:R(l.runAsync.bind(l)),mutate:R(l.mutate.bind(l))}}function be(r,e,t){return xe(r,e,[de,pe,ge,Pe,Re,J,fe,je])}function we(r){return{label:r.roleName,value:r.roleCode}}const nr=({open:r,closeDrawer:e,submitted:t,operateType:n,rowData:i})=>{const{t:s}=G(),[o]=P.useForm(),{data:c,run:f}=be(L,{manual:!0}),l=c?c.map(we):[],u=()=>{e(),o.resetFields()};async function a(){var m;await o.validateFields(),(m=window.$message)==null||m.success(s("common.updateSuccess")),e(),t()}return N(()=>{r&&f()},[r]),d.jsx(W,{onClose:u,title:s(n==="add"?"page.manage.user.addUser":"page.manage.user.editUser"),open:r,footer:d.jsxs(K,{justify:"space-between",children:[d.jsx(B,{onClick:u,children:s("common.cancel")}),d.jsx(B,{onClick:a,type:"primary",children:s("common.confirm")})]}),children:d.jsxs(P,{form:o,initialValues:n==="edit"?i:void 0,layout:"vertical",children:[d.jsx(P.Item,{label:s("page.manage.user.userName"),name:"userName",children:d.jsx(w,{placeholder:s("page.manage.user.form.userName")})}),d.jsx(P.Item,{label:s("page.manage.user.userGender"),name:"userGender",children:d.jsx(b.Group,{children:k.map(m=>d.jsx(b,{value:m.value,children:s(m.label)},m.value))})}),d.jsx(P.Item,{label:s("page.manage.user.nickName"),name:"nickName",children:d.jsx(w,{placeholder:s("page.manage.user.form.nickName")})}),d.jsx(P.Item,{label:s("page.manage.user.userPhone"),name:"userPhone",children:d.jsx(w,{placeholder:s("page.manage.user.form.userPhone")})}),d.jsx(P.Item,{label:s("page.manage.user.userEmail"),name:"email",children:d.jsx(w,{placeholder:s("page.manage.user.form.userEmail")})}),d.jsx(P.Item,{label:s("page.manage.user.userStatus"),name:"status",children:d.jsx(b.Group,{children:I.map(m=>d.jsx(b,{value:m.value,children:s(m.label)},m.value))})}),d.jsx(P.Item,{label:s("page.manage.user.userRole"),name:"roles",children:d.jsx(ee,{options:l,placeholder:s("page.manage.user.form.userRole")})})]})})};export{nr as default};
