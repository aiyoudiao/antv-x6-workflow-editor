var y=Object.defineProperty;var M=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var v=(r,e,t)=>M(r,typeof e!="symbol"?e+"":e,t);import{r as p,er as T,ay as C,w as N,f as U,Q as D,B as G,k as d,J as B}from"./index-By7LVFEb.js";import{i as q,s as z,a as _,b as $,u as V}from"./subscribeFocus-OplqwFfX.js";import{d as J}from"./debounce-0m9V1xj8.js";import{t as Q}from"./throttle-DNHjvvKc.js";import{a as X,u as R}from"./index-dpQjUZq7.js";import{u as Y,e as Z}from"./index-DYIXlKmL.js";import{a as k}from"./system-manage-Cmwiq88e.js";import{F as P}from"./index-BfOb6dPx.js";import{D as I}from"./index-CwVylhdH.js";import{F as L}from"./index-wb5yu5em.js";import{I as w}from"./index-DXjkq9o_.js";import{R as b}from"./iconUtil-bCxqbMW5.js";import{S as W}from"./index-CXc37OxH.js";import"./_baseGetTag-Bq09t9ym.js";import"./tslib.es6-CwN1OpI9.js";import"./index-DaELeVl_.js";import"./index-BdVCeMI6.js";import"./Table-C2PP8qdA.js";import"./index-Be51NT_g.js";import"./DownOutlined-DJfcqcs1.js";import"./index-xcVGidrh.js";import"./EllipsisOutlined-Cjbi_cm8.js";import"./LeftOutlined-B73zp3q9.js";import"./Sider-CXs0ZGHn.js";import"./move-DRqfdePk.js";import"./useBreakpoint-DuXY7LLf.js";import"./responsiveObserver-Df7pYaKA.js";import"./Pagination-BGkHNFMC.js";import"./index-CbKWr7MU.js";import"./index-hY_oRCre.js";import"./SearchOutlined-DaieAUVv.js";import"./form-DIH581c3.js";import"./row-C5RCK80R.js";import"./use-loading-DLtvTDgg.js";import"./index-DWt95HE6.js";import"./index-rlyCioMn.js";import"./index-BlIBobm-.js";import"./index-DjNOYSsE.js";function H(r,e){var t=p.useRef({deps:e,obj:void 0,initialized:!1}).current;return(t.initialized===!1||!T(t.deps,e))&&(t.deps=e,t.obj=r(),t.initialized=!0),t.obj}const A=new Map,K=(r,e,t)=>{const s=A.get(r);s!=null&&s.timer&&clearTimeout(s.timer);let i;e>-1&&(i=setTimeout(()=>{A.delete(r)},e)),A.set(r,{...t,timer:i})},ee=r=>A.get(r),S=new Map,re=r=>S.get(r),te=(r,e)=>{S.set(r,e),e.then(t=>(S.delete(r),t)).catch(()=>{S.delete(r)})},j={},ne=(r,e)=>{j[r]&&j[r].forEach(t=>t(e))},F=(r,e)=>(j[r]||(j[r]=[]),j[r].push(e),function(){const s=j[r].indexOf(e);j[r].splice(s,1)}),se=(r,{cacheKey:e,cacheTime:t=5*60*1e3,staleTime:s=0,setCache:i,getCache:n})=>{const o=p.useRef(),c=p.useRef(),f=(u,a)=>{i?i(a):K(u,t,a),ne(u,a.data)},l=(u,a=[])=>n?n(a):ee(u);return H(()=>{if(!e)return;const u=l(e);u&&Object.hasOwn(u,"data")&&(r.state.data=u.data,r.state.params=u.params,(s===-1||new Date().getTime()-u.time<=s)&&(r.state.loading=!1)),o.current=F(e,a=>{r.setState({data:a})})},[]),C(()=>{var u;(u=o.current)==null||u.call(o)}),e?{onBefore:u=>{const a=l(e,u);return!a||!Object.hasOwn(a,"data")?{}:s===-1||new Date().getTime()-a.time<=s?{loading:!1,data:a==null?void 0:a.data,error:void 0,returnNow:!0}:{data:a==null?void 0:a.data,error:void 0}},onRequest:(u,a)=>{let m=re(e);return m&&m!==c.current?{servicePromise:m}:(m=u(...a),c.current=m,te(e,m),{servicePromise:m})},onSuccess:(u,a)=>{var m;e&&((m=o.current)==null||m.call(o),f(e,{data:u,params:a,time:new Date().getTime()}),o.current=F(e,x=>{r.setState({data:x})}))},onMutate:u=>{var a;e&&((a=o.current)==null||a.call(o),f(e,{data:u,params:r.state.params,time:new Date().getTime()}),o.current=F(e,m=>{r.setState({data:m})}))}}:{}},ie=(r,{debounceWait:e,debounceLeading:t,debounceTrailing:s,debounceMaxWait:i})=>{const n=p.useRef(),o=p.useMemo(()=>{const c={};return t!==void 0&&(c.leading=t),s!==void 0&&(c.trailing=s),i!==void 0&&(c.maxWait=i),c},[t,s,i]);return p.useEffect(()=>{if(e){const c=r.runAsync.bind(r);return n.current=J(f=>{f()},e,o),r.runAsync=(...f)=>new Promise((l,u)=>{var a;(a=n.current)==null||a.call(n,()=>{c(...f).then(l).catch(u)})}),()=>{var f;(f=n.current)==null||f.cancel(),r.runAsync=c}}return()=>{}},[e,o]),e?{onCancel:()=>{var c;(c=n.current)==null||c.cancel()}}:{}},oe=(r,{loadingDelay:e,ready:t})=>{const s=p.useRef();if(!e)return{};const i=()=>{s.current&&clearTimeout(s.current)};return{onBefore:()=>(i(),t!==!1&&(s.current=setTimeout(()=>{r.setState({loading:!0})},e)),{loading:!1}),onFinally:()=>{i()},onCancel:()=>{i()}}},ue=(r,{pollingInterval:e,pollingWhenHidden:t=!0,pollingErrorRetryCount:s=-1})=>{const i=p.useRef(),n=p.useRef(),o=p.useRef(0),c=()=>{var f;i.current&&clearTimeout(i.current),(f=n.current)==null||f.call(n)};return N(()=>{e||c()},[e]),e?{onBefore:()=>(c(),null),onError:()=>{o.current+=1},onSuccess:()=>{o.current=0},onFinally:()=>{s===-1||s!==-1&&o.current<=s?i.current=setTimeout(()=>{!t&&!q()?n.current=z(()=>{r.refresh()}):r.refresh()},e):o.current=0},onCancel:()=>{c()}}:{}};function ae(r,e){let t=!1;return(...s)=>{t||(t=!0,r(...s),setTimeout(()=>{t=!1},e))}}const le=(r,{refreshOnWindowFocus:e,focusTimespan:t=5e3})=>{const s=p.useRef(),i=()=>{var n;(n=s.current)==null||n.call(s)};return p.useEffect(()=>{if(e){const n=ae(r.refresh.bind(r),t);s.current=_(()=>{n()})}return()=>{i()}},[e,t]),C(()=>{i()}),{}},ce=(r,{retryInterval:e,retryCount:t})=>{const s=p.useRef(),i=p.useRef(0),n=p.useRef(!1);return t?{onBefore:()=>(n.current||(i.current=0),n.current=!1,s.current&&clearTimeout(s.current),null),onSuccess:()=>{i.current=0},onError:()=>{if(i.current+=1,t===-1||i.current<=t){const o=e??Math.min(1e3*2**i.current,3e4);s.current=setTimeout(()=>{n.current=!0,r.refresh()},o)}else i.current=0},onCancel:()=>{i.current=0,s.current&&clearTimeout(s.current)}}:{}},me=(r,{throttleWait:e,throttleLeading:t,throttleTrailing:s})=>{const i=p.useRef(),n={};return t!==void 0&&(n.leading=t),s!==void 0&&(n.trailing=s),p.useEffect(()=>{if(e){const o=r.runAsync.bind(r);return i.current=Q(c=>{c()},e,n),r.runAsync=(...c)=>new Promise((f,l)=>{var u;(u=i.current)==null||u.call(i,()=>{o(...c).then(f).catch(l)})}),()=>{var c;r.runAsync=o,(c=i.current)==null||c.cancel()}}return()=>{}},[e,t,s]),e?{onCancel:()=>{var o;(o=i.current)==null||o.cancel()}}:{}};class fe{constructor(e,t,s,i={}){v(this,"pluginImpls");v(this,"count",0);v(this,"state",{loading:!1,params:void 0,response:null,data:void 0,error:null});this.serviceRef=e,this.options=t,this.subscribe=s,this.initState=i,this.state={...this.state,loading:!t.manual,...i}}setState(e={}){this.state={...this.state,...e},this.subscribe()}runPluginHandler(e,...t){const s=this.pluginImpls.map(i=>{var n;return(n=i[e])==null?void 0:n.call(i,...t)}).filter(Boolean);return Object.assign({},...s)}async runAsync(...e){var o,c,f,l,u,a,m,x,O,E;this.count+=1;const t=this.count,{stopNow:s=!1,returnNow:i=!1,...n}=this.runPluginHandler("onBefore",e);if(s)return new Promise(()=>{});if(this.setState({loading:!0,params:e,...n}),i)return Promise.resolve(n.data);(c=(o=this.options).onBefore)==null||c.call(o,e);try{let{servicePromise:h}=this.runPluginHandler("onRequest",this.serviceRef.current,e);h||(h=this.serviceRef.current(...e));const g=await h;return t!==this.count?new Promise(()=>{}):(this.setState({data:g.data,error:null,response:g.response,loading:!1}),(l=(f=this.options).onSuccess)==null||l.call(f,g.data,e),this.runPluginHandler("onSuccess",g,e),(a=(u=this.options).onFinally)==null||a.call(u,e,g.data,null),t===this.count&&this.runPluginHandler("onFinally",e,g,null),g)}catch(h){const g=h;if(t!==this.count)return new Promise(()=>{});throw this.setState({error:g,data:null,response:h.response,loading:!1}),(x=(m=this.options).onError)==null||x.call(m,g,e),this.runPluginHandler("onError",h,e),(E=(O=this.options).onFinally)==null||E.call(O,e,void 0,g),t===this.count&&this.runPluginHandler("onFinally",e,void 0,h),h}}run(...e){this.runAsync(...e).catch(t=>{this.options.onError||console.error(t)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const t=$(e)?e(this.state.data):e;this.runPluginHandler("onMutate",t),this.setState({data:t})}}function de(r,e={},t=[]){const{manual:s=!1,ready:i=!0,...n}=e,o={manual:s,ready:i,...n},c=U(r),f=X(),l=H(()=>{const u=t.map(a=>{var m;return(m=a==null?void 0:a.onInit)==null?void 0:m.call(a,o)}).filter(Boolean);return new fe(c,o,f,Object.assign({},...u))},[]);return l.options=o,l.pluginImpls=t.map(u=>u(l,o)),D(()=>{if(!s&&i){const u=l.state.params||e.defaultParams||[];l.run(...u)}}),C(()=>{l.cancel()}),{loading:l.state.loading,data:l.state.data,error:l.state.error,params:l.state.params||[],cancel:R(l.cancel.bind(l)),refresh:R(l.refresh.bind(l)),refreshAsync:R(l.refreshAsync.bind(l)),run:R(l.run.bind(l)),runAsync:R(l.runAsync.bind(l)),mutate:R(l.mutate.bind(l))}}function pe(r,e,t){return de(r,e,[ie,oe,ue,le,me,V,se,ce])}function ge(r){return{label:r.roleName,value:r.roleCode}}const rr=({open:r,closeDrawer:e,submitted:t,operateType:s,rowData:i})=>{const{t:n}=G(),[o]=P.useForm(),{data:c,run:f}=pe(k,{manual:!0}),l=c?c.map(ge):[],u=()=>{e(),o.resetFields()};async function a(){var m;await o.validateFields(),(m=window.$message)==null||m.success(n("common.updateSuccess")),e(),t()}return N(()=>{r&&f()},[r]),d.jsx(I,{onClose:u,title:n(s==="add"?"page.manage.user.addUser":"page.manage.user.editUser"),open:r,footer:d.jsxs(L,{justify:"space-between",children:[d.jsx(B,{onClick:u,children:n("common.cancel")}),d.jsx(B,{onClick:a,type:"primary",children:n("common.confirm")})]}),children:d.jsxs(P,{form:o,initialValues:s==="edit"?i:void 0,layout:"vertical",children:[d.jsx(P.Item,{label:n("page.manage.user.userName"),name:"userName",children:d.jsx(w,{placeholder:n("page.manage.user.form.userName")})}),d.jsx(P.Item,{label:n("page.manage.user.userGender"),name:"userGender",children:d.jsx(b.Group,{children:Y.map(m=>d.jsx(b,{value:m.value,children:n(m.label)},m.value))})}),d.jsx(P.Item,{label:n("page.manage.user.nickName"),name:"nickName",children:d.jsx(w,{placeholder:n("page.manage.user.form.nickName")})}),d.jsx(P.Item,{label:n("page.manage.user.userPhone"),name:"userPhone",children:d.jsx(w,{placeholder:n("page.manage.user.form.userPhone")})}),d.jsx(P.Item,{label:n("page.manage.user.userEmail"),name:"email",children:d.jsx(w,{placeholder:n("page.manage.user.form.userEmail")})}),d.jsx(P.Item,{label:n("page.manage.user.userStatus"),name:"status",children:d.jsx(b.Group,{children:Z.map(m=>d.jsx(b,{value:m.value,children:n(m.label)},m.value))})}),d.jsx(P.Item,{label:n("page.manage.user.userRole"),name:"roles",children:d.jsx(W,{options:l,placeholder:n("page.manage.user.form.userRole")})})]})})};export{rr as default};
